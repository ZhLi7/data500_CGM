if (is.logical(x)) return(x)
if (is.numeric(x)) return(x == 1)
if (is.character(x)) return(tolower(trimws(x)) %in% c("true","t","1","yes","y"))
suppressWarnings(as.logical(x))
}
# Choose availability columns by name pattern
avail_cols <- participants |>
dplyr::select(dplyr::matches("^(cardiac_ecg|clinical_data|environment|retinal_|wearable)"))
# Fallback: any likely logical columns
if (ncol(avail_cols) == 0) {
avail_cols <- participants |>
dplyr::select(where(~ is.logical(.x) || is.numeric(.x) || is.character(.x)))
}
# Summarize
avail_summary <- avail_cols |>
dplyr::mutate(dplyr::across(dplyr::everything(), to_logical)) |>
dplyr::summarise(dplyr::across(dplyr::everything(), ~ sum(.x %in% TRUE, na.rm = TRUE))) |>
tidyr::pivot_longer(dplyr::everything(), names_to = "modality", values_to = "N available") |>
dplyr::mutate(
n_total = nrow(participants),
prop_available = n_available / n_total,
modality_pretty = modality |> stringr::str_replace_all("_", " ") |> stringr::str_to_title()
) |>
dplyr::arrange(dplyr::desc(prop_available))
# Coerce different encodings to logical
to_logical <- function(x) {
if (is.logical(x)) return(x)
if (is.numeric(x)) return(x == 1)
if (is.character(x)) return(tolower(trimws(x)) %in% c("true","t","1","yes","y"))
suppressWarnings(as.logical(x))
}
# Choose availability columns by name pattern
avail_cols <- participants |>
dplyr::select(dplyr::matches("^(cardiac_ecg|clinical_data|environment|retinal_|wearable)"))
# Fallback: any likely logical columns
if (ncol(avail_cols) == 0) {
avail_cols <- participants |>
dplyr::select(where(~ is.logical(.x) || is.numeric(.x) || is.character(.x)))
}
# Summarize
avail_summary <- avail_cols |>
dplyr::mutate(dplyr::across(dplyr::everything(), to_logical)) |>
dplyr::summarise(dplyr::across(dplyr::everything(), ~ sum(.x %in% TRUE, na.rm = TRUE))) |>
tidyr::pivot_longer(dplyr::everything(), names_to = "modality", values_to = "n_available") |>
dplyr::mutate(
n_total = nrow(participants),
prop_available = n_available / n_total,
modality_pretty = modality |> stringr::str_replace_all("_", " ") |> stringr::str_to_title()
) |>
dplyr::arrange(dplyr::desc(prop_available))
# Show table
knitr::kable(
avail_summary |>
dplyr::select(modality = modality_pretty, n_available, n_total, prop_available) |>
dplyr::mutate(prop_available = scales::percent(prop_available, accuracy = 0.1)),
caption = "Availability of each modality among participants.",
align = "lrrr",
digits = 3
) |>
kableExtra::kable_styling(full_width = FALSE)
ggplot(avail_summary, aes(x = reorder(modality_pretty, prop_available), y = prop_available)) +
geom_col() +
coord_flip() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = NULL,
y = "Participants with data available",
title = "Data availability by modality"
) +
theme_minimal(base_size = 12)
demo_cols <- dplyr::intersect(names(participants), c("age", "study_group", "clinical_site", "recommended_split", "study_visit_date"))
if (length(demo_cols)) {
message(glue::glue("Summarizing columns: {paste(demo_cols, collapse = ', ')}"))
if ("age" %in% names(participants)) {
age_tbl <- participants |>
dplyr::summarise(
n = dplyr::n(),
mean_age = mean(age, na.rm = TRUE),
sd_age = sd(age, na.rm = TRUE),
min_age = min(age, na.rm = TRUE),
max_age = max(age, na.rm = TRUE)
)
knitr::kable(age_tbl, caption = "Age summary (if `age` exists).") |>
kableExtra::kable_styling(full_width = FALSE)
}
if (all(c("study_group","clinical_site") %in% names(participants))) {
grp_tbl <- participants |>
dplyr::count(study_group, clinical_site, name = "n") |>
dplyr::arrange(dplyr::desc(n))
knitr::kable(grp_tbl, caption = "Counts by study group and clinical site (if columns exist).") |>
kableExtra::kable_styling(full_width = FALSE)
}
}
demo_cols <- dplyr::intersect(names(participants), c("age", "study_group", "clinical_site", "recommended_split", "study_visit_date"))
if (length(demo_cols)) {
message(glue::glue("Summarizing columns: {paste(demo_cols, collapse = ', ')}"))
if ("age" %in% names(participants)) {
age_tbl <- participants |>
dplyr::summarise(
n = dplyr::n(),
mean_age = mean(age, na.rm = TRUE),
sd_age = sd(age, na.rm = TRUE),
min_age = min(age, na.rm = TRUE),
max_age = max(age, na.rm = TRUE)
)
knitr::kable(age_tbl, caption = "Age summary (if `age` exists).") |>
kableExtra::kable_styling(full_width = FALSE)
}
if (all(c("study_group","clinical_site") %in% names(participants))) {
grp_tbl <- participants |>
dplyr::count(study_group, clinical_site, name = "n") |>
dplyr::arrange(study_group, dplyr::desc(n),clinical_site)
knitr::kable(grp_tbl, caption = "Counts by study group and clinical site (if columns exist).") |>
kableExtra::kable_styling(full_width = FALSE)
}
}
demo_cols <- dplyr::intersect(names(participants), c("age", "study_group", "clinical_site", "recommended_split", "study_visit_date"))
if (length(demo_cols)) {
message(glue::glue("Summarizing columns: {paste(demo_cols, collapse = ', ')}"))
if ("age" %in% names(participants)) {
age_tbl <- participants |>
dplyr::summarise(
n = dplyr::n(),
mean_age = mean(age, na.rm = TRUE),
sd_age = sd(age, na.rm = TRUE),
min_age = min(age, na.rm = TRUE),
max_age = max(age, na.rm = TRUE)
)
knitr::kable(age_tbl, caption = "Age summary (if `age` exists).") |>
kableExtra::kable_styling(full_width = FALSE)
}
if (all(c("study_group","clinical_site") %in% names(participants))) {
grp_tbl <- participants |>
dplyr::count(study_group, clinical_site, name = "n") |>
dplyr::arrange(study_group, dplyr::desc(n),clinical_site)
knitr::kable(grp_tbl, caption = "Counts by study group and clinical site (if columns exist).") |>
kableExtra::kable_styling(full_width = FALSE)
}
}
# ---- table: study group counts + mean age ----
if ("study_group" %in% names(participants)) {
sg_tbl <- participants |>
dplyr::mutate(age = suppressWarnings(as.numeric(age))) |>
dplyr::group_by(study_group) |>
dplyr::summarise(
n = dplyr::n(),
mean_age = mean(age, na.rm = TRUE),
.groups = "drop"
) |>
dplyr::arrange(dplyr::desc(n))
knitr::kable(
sg_tbl,
digits = 1,
caption = "Participants and mean age by study group."
) |>
kableExtra::kable_styling(full_width = FALSE)
}
# ---- plots: clinical site proportions and nested donut ----
need_pkgs <- c("ggplot2", "scales", "ggnewscale")
to_install <- need_pkgs[!need_pkgs %in% rownames(installed.packages())]
if (length(to_install)) install.packages(to_install, quiet = TRUE)
lapply(need_pkgs, library, character.only = TRUE)
if ("clinical_site" %in% names(participants)) {
# Pie: proportion by clinical site
site_counts <- participants |>
dplyr::count(clinical_site, name = "n") |>
dplyr::mutate(prop = n / sum(n))
ggplot(site_counts, aes(x = "", y = prop, fill = clinical_site)) +
geom_col(color = "white") +
coord_polar(theta = "y") +
theme_void() +
labs(title = "Participants by clinical site (proportion)",
y = NULL, x = NULL, fill = "Clinical site") +
scale_y_continuous(labels = scales::percent)
# Nested donut: inner = clinical site, outer = study group within site
sg_site <- participants |>
dplyr::count(clinical_site, study_group, name = "n")
site_totals <- sg_site |>
dplyr::group_by(clinical_site) |>
dplyr::summarise(n = sum(n), .groups = "drop")
ggplot() +
# Inner ring: clinical sites
geom_bar(
data = site_totals,
aes(x = 1, y = n, fill = clinical_site),
stat = "identity", width = 1, color = "white"
) +
scale_fill_discrete(name = "Clinical site") +
ggnewscale::new_scale_fill() +
# Outer ring: study groups within each site
geom_bar(
data = sg_site,
aes(x = 2, y = n, fill = study_group),
stat = "identity", width = 1, color = "white"
) +
scale_fill_discrete(name = "Study group") +
coord_polar(theta = "y") +
xlim(0.5, 2.5) +
theme_void() +
labs(title = "Nested donut: inner = site; outer = study group within site")
}
# ---- plot A: participants per clinical site (bar) ----
site_counts <- participants |>
dplyr::count(clinical_site, name = "n") |>
dplyr::arrange(dplyr::desc(n))
ggplot(site_counts, aes(x = reorder(clinical_site, n), y = n)) +
geom_col() +
coord_flip() +
labs(
title = "Participants per clinical site",
x = "Clinical site",
y = "Number of participants"
) +
theme_minimal(base_size = 12)
# ---- plot A: participants per clinical site (bar) ----
site_counts <- participants |>
dplyr::count(clinical_site, name = "n") |>
dplyr::arrange(dplyr::desc(n))
ggplot(site_counts, aes(x = reorder(clinical_site, n), y = n)) +
geom_col() +
coord_flip() +
labs(
title = "Participants per clinical site",
x = "Clinical site",
y = "Number of participants"
) +
theme_minimal(base_size = 12)
# ---- plot B: study-group bars within each clinical site (faceted) ----
sg_site <- participants |>
dplyr::count(clinical_site, study_group, name = "n")
ggplot(sg_site, aes(x = study_group, y = n)) +
geom_col() +
facet_wrap(~ clinical_site, scales = "free_x") +
coord_flip() +
labs(
title = "Study-group counts within each clinical site",
x = "Study group",
y = "Number of participants"
) +
theme_minimal(base_size = 11)
# ---- plot A: participants per clinical site (bar) ----
site_counts <- participants |>
dplyr::count(clinical_site, name = "n") |>
dplyr::arrange(dplyr::desc(n))
ggplot(site_counts, aes(x = reorder(clinical_site, n), y = n)) +
geom_col() +
coord_flip() +
labs(
title = "Participants per clinical site",
x = "Clinical site",
y = "Number of participants"
) +
theme_minimal(base_size = 12)
# ---- plot B: study-group bars within each clinical site (faceted) ----
sg_site <- participants |>
dplyr::count(clinical_site, study_group, name = "n")
ggplot(sg_site, aes(x = study_group, y = n)) +
geom_col() +
facet_wrap(~ clinical_site, scales = "free_x") +
coord_flip() +
labs(
title = "Study-group counts within each clinical site",
x = "Study group",
y = "Number of participants"
) +
theme_minimal(base_size = 11)
ggplot(sg_site, aes(x = study_group, y = n / sum(n))) +
geom_col() +
facet_wrap(~ clinical_site, scales = "free_x") +
coord_flip() +
scale_y_continuous(labels = scales::percent_format()) +
labs(title = "Study-group proportions within each clinical site",
x = "Study group", y = "Proportion of site")
# ---- plot B: study-group bars within each clinical site (faceted) ----
sg_site <- participants |>
dplyr::count(clinical_site, study_group, name = "n")
ggplot(sg_site, aes(x = study_group, y = n)) +
geom_col() +
facet_wrap(~ clinical_site, scales = "free_x") +
coord_flip() +
labs(
title = "Study-group counts within each clinical site",
x = "Study group",
y = "Number of participants"
) +
theme_minimal(base_size = 11)
# ---- plot A: participants per clinical site (bar) ----
site_counts <- participants |>
dplyr::count(clinical_site, name = "n") |>
dplyr::arrange(dplyr::desc(n))
ggplot(site_counts, aes(x = reorder(clinical_site, n), y = n)) +
geom_col() +
coord_flip() +
labs(
title = "Participants per clinical site",
x = "Clinical site",
y = "Number of participants"
) +
theme_minimal(base_size = 12)
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = TRUE)
library(here)
pkgs <- c("tidyverse", "janitor", "readr", "knitr", "kableExtra", "scales", "lubridate", "glue")
to_install <- pkgs[!pkgs %in% rownames(installed.packages())]
if (length(to_install)) install.packages(to_install, quiet = TRUE)
invisible(lapply(pkgs, library, character.only = TRUE))
participants <-readr::read_tsv(here::here("data/participants.tsv")) |>
janitor::clean_names()
head(participants, 10)
# Coerce different encodings to logical
to_logical <- function(x) {
if (is.logical(x)) return(x)
if (is.numeric(x)) return(x == 1)
if (is.character(x)) return(tolower(trimws(x)) %in% c("true","t","1","yes","y"))
suppressWarnings(as.logical(x))
}
# Choose availability columns by name pattern
avail_cols <- participants |>
dplyr::select(dplyr::matches("^(cardiac_ecg|clinical_data|environment|retinal_|wearable)"))
# Fallback: any likely logical columns
if (ncol(avail_cols) == 0) {
avail_cols <- participants |>
dplyr::select(where(~ is.logical(.x) || is.numeric(.x) || is.character(.x)))
}
# Summarize
avail_summary <- avail_cols |>
dplyr::mutate(dplyr::across(dplyr::everything(), to_logical)) |>
dplyr::summarise(dplyr::across(dplyr::everything(), ~ sum(.x %in% TRUE, na.rm = TRUE))) |>
tidyr::pivot_longer(dplyr::everything(), names_to = "modality", values_to = "n_available") |>
dplyr::mutate(
n_total = nrow(participants),
prop_available = n_available / n_total,
modality_pretty = modality |> stringr::str_replace_all("_", " ") |> stringr::str_to_title()
) |>
dplyr::arrange(dplyr::desc(prop_available))
# Show table
knitr::kable(
avail_summary |>
dplyr::select(modality = modality_pretty, n_available, n_total, prop_available) |>
dplyr::mutate(prop_available = scales::percent(prop_available, accuracy = 0.1)),
caption = "Availability of each modality among participants.",
align = "lrrr",
digits = 3
) |>
kableExtra::kable_styling(full_width = FALSE)
ggplot(avail_summary, aes(x = reorder(modality_pretty, prop_available), y = prop_available)) +
geom_col() +
coord_flip() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = NULL,
y = "Participants with data available",
title = "Data availability by modality"
) +
theme_minimal(base_size = 12)
# ---- table: study group counts + mean age ----
if ("study_group" %in% names(participants)) {
sg_tbl <- participants |>
dplyr::mutate(age = suppressWarnings(as.numeric(age))) |>
dplyr::group_by(study_group) |>
dplyr::summarise(
n = dplyr::n(),
mean_age = mean(age, na.rm = TRUE),
.groups = "drop"
) |>
dplyr::arrange(dplyr::desc(n))
knitr::kable(
sg_tbl,
digits = 1,
caption = "Participants and mean age by study group."
) |>
kableExtra::kable_styling(full_width = FALSE)
}
# ---- plot A: participants per clinical site (bar) ----
site_counts <- participants |>
dplyr::count(clinical_site, name = "n") |>
dplyr::arrange(dplyr::desc(n))
ggplot(site_counts, aes(x = reorder(clinical_site, n), y = n)) +
geom_col() +
coord_flip() +
labs(
title = "Participants per clinical site",
x = "Clinical site",
y = "Number of participants"
) +
theme_minimal(base_size = 12)
# Coerce different encodings to logical
to_logical <- function(x) {
if (is.logical(x)) return(x)
if (is.numeric(x)) return(x == 1)
if (is.character(x)) return(tolower(trimws(x)) %in% c("true","t","1","yes","y"))
suppressWarnings(as.logical(x))
}
# Choose availability columns by name pattern
avail_cols <- participants |>
dplyr::select(dplyr::matches("^(cardiac_ecg|clinical_data|environment|retinal_|wearable)"))
# Fallback: any likely logical columns
if (ncol(avail_cols) == 0) {
avail_cols <- participants |>
dplyr::select(where(~ is.logical(.x) || is.numeric(.x) || is.character(.x)))
}
# Summarize
avail_summary <- avail_cols |>
dplyr::mutate(dplyr::across(dplyr::everything(), to_logical)) |>
dplyr::summarise(dplyr::across(dplyr::everything(), ~ sum(.x %in% TRUE, na.rm = TRUE))) |>
tidyr::pivot_longer(dplyr::everything(), names_to = "modality", values_to = "n_available") |>
dplyr::mutate(
n_total = nrow(participants),
prop_available = n_available / n_total,
modality_pretty = modality |> stringr::str_replace_all("_", " ") |> stringr::str_to_title()
) |>
dplyr::arrange(dplyr::desc(prop_available))
# Show table
knitr::kable(
avail_summary |>
dplyr::select(modality = modality_pretty, n_available, n_total, prop_available) |>
dplyr::mutate(prop_available = scales::percent(prop_available, accuracy = 0.1)),
caption = "Availability of each modality among participants.",
align = "lrrr",
digits = 3
) |>
kableExtra::kable_styling(full_width = FALSE)
View(data)
# ---- plot B: study-group bars within each clinical site (faceted) ----
sg_site <- participants |>
dplyr::count(clinical_site, study_group, name = "n")
ggplot(sg_site, aes(x = study_group, y = n)) +
geom_col() +
facet_wrap(~ clinical_site, scales = "free_x") +
coord_flip() +
labs(
title = "Study-group counts within each clinical site",
x = "Study group",
y = "Number of participants"
) +
theme_minimal(base_size = 11)
View(avail_summary)
knitr::opts_chunk$set(message = FALSE, warning = FALSE, echo = TRUE)
library(here)
pkgs <- c("tidyverse", "janitor", "readr", "knitr", "kableExtra", "scales", "lubridate", "glue")
to_install <- pkgs[!pkgs %in% rownames(installed.packages())]
if (length(to_install)) install.packages(to_install, quiet = TRUE)
invisible(lapply(pkgs, library, character.only = TRUE))
participants <-readr::read_tsv(here::here("data/participants.tsv")) |>
janitor::clean_names()
head(participants, 10)
# Coerce different encodings to logical
to_logical <- function(x) {
if (is.logical(x)) return(x)
if (is.numeric(x)) return(x == 1)
if (is.character(x)) return(tolower(trimws(x)) %in% c("true","t","1","yes","y"))
suppressWarnings(as.logical(x))
}
# Choose availability columns by name pattern
avail_cols <- participants |>
dplyr::select(dplyr::matches("^(cardiac_ecg|clinical_data|environment|retinal_|wearable)"))
# Fallback: any likely logical columns
if (ncol(avail_cols) == 0) {
avail_cols <- participants |>
dplyr::select(where(~ is.logical(.x) || is.numeric(.x) || is.character(.x)))
}
# Summarize
avail_summary <- avail_cols |>
dplyr::mutate(dplyr::across(dplyr::everything(), to_logical)) |>
dplyr::summarise(dplyr::across(dplyr::everything(), ~ sum(.x %in% TRUE, na.rm = TRUE))) |>
tidyr::pivot_longer(dplyr::everything(), names_to = "modality", values_to = "n_available") |>
dplyr::mutate(
n_total = nrow(participants),
prop_available = n_available / n_total,
modality_pretty = modality |> stringr::str_replace_all("_", " ") |> stringr::str_to_title()
) |>
dplyr::arrange(dplyr::desc(prop_available))
# Show table
knitr::kable(
avail_summary |>
dplyr::select(modality = modality_pretty, n_available, n_total, prop_available) |>
dplyr::mutate(prop_available = scales::percent(prop_available, accuracy = 0.1)),
caption = "Availability of each modality among participants.",
align = "lrrr",
digits = 3
) |>
kableExtra::kable_styling(full_width = FALSE)
ggplot(avail_summary, aes(x = reorder(modality_pretty, prop_available), y = prop_available)) +
geom_col() +
coord_flip() +
scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
labs(
x = NULL,
y = "Participants with data available",
title = "Data availability by modality"
) +
theme_minimal(base_size = 12)
# ---- table: study group counts + mean age ----
if ("study_group" %in% names(participants)) {
sg_tbl <- participants |>
dplyr::mutate(age = suppressWarnings(as.numeric(age))) |>
dplyr::group_by(study_group) |>
dplyr::summarise(
n = dplyr::n(),
mean_age = mean(age, na.rm = TRUE),
.groups = "drop"
) |>
dplyr::arrange(dplyr::desc(n))
knitr::kable(
sg_tbl,
digits = 1,
caption = "Participants and mean age by study group."
) |>
kableExtra::kable_styling(full_width = FALSE)
}
renv::init()
reticulate::repl_python()
reticulate::repl_python()
